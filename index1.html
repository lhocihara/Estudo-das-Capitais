<?php include_once("map.php");?>
<html>
	<head>
		<meta charset="utf-8">
		<title>Teste de Kenji</title>

		<style type="text/css" id="style6">
			.str0 {stroke:#1F1A17;stroke-width:76}
			.str2 {stroke:#1F1A17;stroke-width:281}
			.str1 {stroke:#72706F;stroke-width:352}
			.str3 {stroke:#1F1A17;stroke-width:704}
			.fil3 {fill:none}
			.fil0 {fill:#BFD8FF}
			.fil1 {fill:#F4E2BA}
			.fil2 {fill:#FFF3E3}
			.fil4 {fill:#00BB70}
			.fil5 {fill:#FF9900}
			.fil6 {fill:#Ff0000}
			.fil7 {fill:#00FFFF}
			.fil8 {fill:#FFFF00}
		</style>
		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/master.css"  media="screen,projection"/>
		<link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
		<link type="text/css" rel="stylesheet" href="css/style_progress_bar.css"  media="screen,projection"/>
		<script type="text/javascript" src="js/jquery-3.1.1.js"></script>
		<script type="text/javascript" src="js/materialize.min.js"></script>
		<script type="text/javascript" src="js/script-progress-bar.js"></script>
	</head>
<!-- Creator: CorelDRAW -->
	<body>
		<div id="box-menu">
			<ul class="menu row">
				<li class="col s1 item-menu master-dropdown">
					<a id="menu-btn" href="javascript:void(0)" class="waves-effect btn red">Menu</a>
					<div class="master-dropdown-content">
						<a class="link" href="../iswe/">Home</a>
						<a class="link" href="project.html">O Projeto</a>
						<a class="link" href="code.html">O Código</a>
						<a class="link" href="group.html">O Grupo</a>
					</div>
				</li>
				<li class="col s10 item-menu master-dropdown center">
					<img id="logo" src="img/logo.jpeg"/>
				</li>	
			</ul>
		</div>	
		<div id="box-page">
			<div id="content-title" class="row center" style="margin-bottom:0">	
				<div id="title-page" class="medium-words">Estudo das Capitais</div>
			</div>
			
			<div id="content-page-map" class="row">				
				<div id="box-meters" class="col l3 box-meters hide-on-med-and-down">
					<div id="box-timer" style="display:block;">
						<span id="box-label-timer" class="col l12">
							<span id="content-label-timer" class="small-words">Tempo</span>
						</span>
						<span id="box-content-timer" class="col l12 center">
							<div id="box-design-timer" >
								<span id="content-timer" class="big-words">
									<span class="small-words"><br>Carregando...</span>
								</span>
							</div>
						</span>	
					</div>
				
					<div id="box-score" style="display:block;">
						<span id="box-label-score" class="col l12">
							<span id="content-label-score" class="small-words">Pontuação</span>
						</span>
						<span id="box-content-score" class="col l12 center">
							<span id="content-score" class="big-words" style="">0%</span>
						</span>	
					</div>
				</div>
				
				
			</div>

			<div id="box-map" class="col l6 hide-on-med-and-down">
				<?php showMap(); ?>
			</div>

			</div>
			<div id="back" class="absolute back hide" onclick="closeBox();"></div>
			<div id="box-card" class="content-absolute hide">	
				<div id="content-card" class="card">
					<div class="row" style="padding: 0 5px; min-height:130px; margin-bottom:0;">
						<div class="card-image col s6 offset-s3" id="box-image"></div>
						<span id="closeButtonCard" class="col s2 offset-s1 waves-effect waves-light btn red" style="border-radius: 0 0 20px 20px; background-color: #ea4438;" onclick="closeBox();">X</span>	
					</div>	
					<div class="row" style="margin:0;">
						<div class="card-title center" id="box-title"></div>
					</div>
					<div class="row">
						<div class="card-content">
							<div style="display:grid;">
								<div class="row">
									<a id="opc1" onclick="check(this)" style=" width: 300px">button</a>
								</div>
								<div class="row">
									<a id="opc2" onclick="check(this)" style="width: 300px">button</a>
								</div>
								<div class="row">
									<a id="opc3" onclick="check(this)" style="width: 300px">button</a>
								</div>
								<div class="row">
									<a id="opc4" onclick="check(this)" style="width: 300px">button</a>
								</div>
							</div>
						</div>	
					</div>
				</div>
			</div>
			<div id="box-msg" class="content-absolute hide">	
				<div id="content-msg" class="card">
					<div class="row"style="padding: 0 5px;">
						<span id="closeButtonMsg" class="col s2 offset-s10 waves-effect waves-light btn red" style="border-radius: 0 0 20px 20px; background-color: #ea4438;" onclick="closeBox();">X</span>
					</div>
					<div id="title-msg" class="card-title center row"></div>
				</div>			
			</div>
			
			
			<div id="box-result" class="content-absolute hide">	
				<div id="content-result" class="card">
					<div id="box-reason-result" class="card-title center row">
						<div id="content-reason-result" class="big-words"></div>
					</div>
					<div id="title-result" class="card-title center row">Confira seu resultado abaixo:</div>
					<div class="row">
						<div id="box-timer-result" class="col s6" style="display:block;">
							<span id="box-label-timer-result" class="col s12">
								<span id="content-label-timer-result" class="small-words">Tempo</span>
							</span>
							<span id="box-content-timer-result" class="col s12 center">
								<div id="box-design-timer-result" >
									<span id="content-timer-result" class="big-words">
										<span class="small-words">Carregando...</span>
									</span>
								</div>
							</span>	
						</div>

						<div id="box-score-result" class="col l6" style="display:block;z-index:99999">
							<span id="box-label-score-result" class="col l12">
								<span id="content-label-score-result" class="small-words">Pontuação</span>
							</span>
							<span id="box-content-score-result" class="col s12 center">
								<div id="box-design-score-result" >
									<span id="content-score-result" class="big-words">
										<span class="small-words">Carregando...</span>
									</span>
								</div>
							</span>
						</div>
					</div>
					<div class="row">
						<div class="col s12">
							<i class="medium-words center"><div id="status-result" style="border: 2px dotted black; color: azure;">Perdeu</div></i>
						</div>
					</div>
					
					<div class="row">
						<div>
							<div id="content-start" style="text-align:center;">
								<a id="opc1" class="waves-effect waves-light green btn" style="width: 300px" href="test.php">DE NOVO!</a>
							</div>
						</div>
					</div>
				</div>			
			</div>
		</div>
		
		<script>
			chekedAnserwed = false;
			current_id = null; // Id do estado atual
			optionsUsedArray = []; // Array de opções já usadas (no card do quiz) - armazena o id dos estados
			score = 0; // Pontuação do usuário
			percentual = 0;
			/* Array de id => sigla dos estados */
			SiglaArray = {
				0: 'ac',1: 'al',2: 'ap',3: 'am',4: 'ba',5: 'ce',6: 'df',7: 'es',8: 'go',9: 'ma',10: 'mt',
				11: 'ms',12: 'mg',13: 'pa',14: 'pb',15: 'pr',16: 'pe',17: 'pi',18: 'rj',19: 'rn',20: 'rs',
				21: 'ro',22: 'rr',23: 'sc',24: 'sp',25: 'se',26: 'to'
			};
			/* Array de sigla dos estados => capital dos estados */
			CapitaisArray = {
				'ac': 'Rio Branco','al': 'Maceió','ap': 'Macapá','am': 'Manaus','ba': 'Salvador','ce': 'Fortaleza',
				'df': 'Brasília','es': 'Vitória','go': 'Goiânia','ma': 'São Luís','mt': 'Cuiabá','ms': 'Campo Grande',
				'mg': 'Belo Horizonte','pa': 'Belém','pb': 'João Pessoa','pr': 'Curitiba','pe': 'Recife','pi': 'Teresina',
				'rj': 'Rio de Janeiro','rn': 'Natal','rs': 'Porto Alegre','ro': 'Porto Velho','rr': 'Boa Vista',
				'sc': 'Florianópolis','sp': 'São Paulo','se': 'Aracaju','to': 'Palmas'
			};

			countStates = 27; // Total de estados do país
			countTimer = 1; // Total de segundos
//			intervalo = window.setInterval(function() {
//									if(countTimer%1 != 0){
//
//									}
//									$("#content-timer").html(countTimer + "s");
//
//									if(countStates == 0){
//										showResult("Terminado!");
//										clearInterval(intervalo);	
//									}
//
//									countTimer--;
//							}, 1000);
//
//			window.setTimeout(function() {
//				if(countStates != 0){
//					showResult("Acabou o Tempo!");
//					clearInterval(intervalo);
//				}
//			}, (countTimer +1.5)*1000);
			
			
			
			
			
			/* Função que exibe o card do quiz */
			function showBox(id){
				// Verificação de trapaça
				if(id !== current_id){ 
					// Se id do estado selecionado é diferente do current_id armazenado, carrega novas opções de respostas
					current_id = id;
					popOptions();
				}

				item = document.getElementById(id); // Recebendo o elemento
				
				$("#box-title").html("<span class='card-title'>Capital do <span style='color: red'>"+$(item).attr("text")+"</span> é?</span>");
				
				// configurando os box que precisam aparecer para o usuário
				$('#box-image').html("<img src='img/"+id+".png' style='position: relative;left: calc(50% - 80px);height:auto;width:160px;' />");
				$("#back").attr("class","absolute back");
				$("#box-card").attr("class","content-absolute");
			}

			/* Função que exibe o box de mensagem */
			function showMsg(msg){
				// Configurando classe para que os elementos apareçam na tela
				$("#back").attr("class","absolute back");
				$("#box-msg").attr("class","content-absolute");
				$("#title-msg").html(msg);
				
			}
			
			function showResult(title){	
				closeBox();
				
				$("#content-reason-result").html(title);
				
				$("#back").attr("class","absolute back");
				$("#box-result").attr("class","content-absolute");
				
				$("#content-timer-result").html(countTimer + "s");
				$("#content-score-result").html(percentual + "%");
				
				if(percentual == 100){
					$("#content-reason-result").attr("style","color: green");
					$("#status-result").html("Acertou tudo!"); 
					$("#status-result").attr("class","green");
				}
				else {
					$("#content-reason-result").attr("style","color: red");
					if(countTimer < 0){
						$("#content-timer-result").html("0s");
						
						if(score > 20){
							$("#status-result").html("Foi por pouco..."); 
							$("#status-result").attr("class","orange");
						}
						else{
							$("#status-result").html("Faltou tempo, hein..."); 
							$("#status-result").attr("class","orange");
						}
					}
					else{
						$("#status-result").html("Tente de novo!"); 
						$("#status-result").attr("class","red");
					}
				}
			}
			
			/* Função que esconde o card do quiz ou o box da mensagem */
			function closeBox(){
				// Configurando classe "hide" para os elementos que precisam sumir da tela
				$("#back").attr("class","hide");
				$("#box-card").attr("class","hide");
				$("#box-msg").attr("class","hide");
				$("#box-result").attr("class","hide");
			}
			
			/* Função que carrega as opções do card do quiz */
			function popOptions(){
				chekedAnserwed = false;
				// Colocando o estado atual na lista de opções já usadas.
				optionsUsedArray[0] = current_id;

				// Gerando uma nova posição para a opção correta
				do{
					c = Math.floor((Math.random() * 4) + 1);
				} while(c == 0);

				// Gerando as opções
				for(var n = 1; n <= 4; n++){
					// Verificando se o número da opção é o mesmo que o da opção selecionada para ser a correta
					if(n == c){
						// Gerando a opção correta
						$("#opc"+n).attr("value",CapitaisArray[current_id]);
						$("#opc"+n).html(CapitaisArray[current_id]);
					}
					else{
						// Gerando um novo id do estado para usar como opção errada
						var stateNumber = Math.floor((Math.random() * 26) + 1);
						
						do{
							var equal = false; // Variável que mostrará se o loop achou opções iguais

							// Loop de opções utilizadas
							for(var i = 0; i < optionsUsedArray.length; i++){
								// Verificando se o id do estado atual já foi usado nesse card
								if(SiglaArray[stateNumber] == optionsUsedArray[i]){
									// Gerando um novo id de estado
									stateNumber = Math.floor((Math.random() * 26) + 1);
									equal = true; // Mostrando que existem estados iguais nas opções
								}
							}
						}while(equal == true);
						
						// Gerando a opção falsa
						$("#opc"+n).attr("value","'"+CapitaisArray[SiglaArray[stateNumber]]+"'");
						$("#opc"+n).html(CapitaisArray[SiglaArray[stateNumber]]);

						// adicionando um novo id de estado a lista de estados usadas como opção
						optionsUsedArray[n] = SiglaArray[stateNumber];
					} // Fim do loop que gera opções
					
					$("#opc"+n).attr("class","waves-effect waves-light btn");
				}	// Fim do loop do número de opções									
			}

			/* Função que verifica a opção selecionada no card do quiz */
			function check(Option){
				
				
				if(chekedAnserwed == false){
					countStates--;
					chekedAnserwed = true;
					item = document.getElementById(current_id); // Recebendo o elemento

					// Estipulando que o usuário errou a questão (pintando, no mapa, o estado de cinza)
					$(item).attr("style", "fill: #E51C23;fill-opacity:1;stroke:#ffffff;stroke-opacity:1;stroke-width:282.23677982;stroke-miterlimit:4;stroke-dasharray:none");

					for(var i = 1; i <= optionsUsedArray.length; i++){
						// Verificando se a capital da opção atual é a capital correta
						if($("#opc"+i).attr("value") == CapitaisArray[current_id]){
							$("#opc"+i).attr("class", "btn waves-effect green darker-1"); // Exibindo que é a opção correta


							//Verificando se a opção atual(correta) é a opção que o usuário selecionou
							if($("#opc"+i).attr("value") == $(Option).attr("value")){
								score++; // Aumentando a pontuação do usuário

								console.log("Pontuação: " + score);

								percentual = (score * 100) / 27;

								percentual = parseFloat(percentual.toFixed(2))

								$("#content-score").html(percentual + "%");

								// exibindo ao usuário que ele acertou a capital do estado (pintando, no mapa, o estado de dourado)
								$(item).attr("style", "fill: #4CAF50;fill-opacity:1;stroke:#ffffff;stroke-opacity:1;stroke-width:282.23677982;stroke-miterlimit:4;stroke-dasharray:none");
							}
						}
						else{
							$("#opc"+i).attr("class", "btn waves-effect materialize-red darker-1"); //Exibindo que é a opção errada
						}
					}

					// Retira a possibilidade de refazer o card
					$(item).attr("onclick", "showMsg('Você já respondeu este.<br>Tente outro!');");
				}
			}
		</script>
	</body>    
</html>